<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Anteroom to the Land Story</title>
  
  <subtitle>Hallway of the Forbidden Scrollery</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-06-11T11:21:30.750Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>LamTheEnder</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>A forgotten CTF Writeup</title>
    <link href="http://example.com/2022/06/11/A-forgotten-CTF-Writeup/"/>
    <id>http://example.com/2022/06/11/A-forgotten-CTF-Writeup/</id>
    <published>2022-06-11T06:18:50.000Z</published>
    <updated>2022-06-11T11:21:30.750Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Foreword"><a href="#Foreword" class="headerlink" title="Foreword"></a>Foreword</h2><p>This is my first ever CTF writeup I ever done in my life, since I ever delved into the rabbit hole of CTF and cybersecurity. </p><p>The challenge is from the CTFFlag Asia Junior</p><p>I’ll put a link here if you want to learn more:<br><a href="https://junior.ctflag.asia/">CTFFlag Asia Junior</a></p><p>(I never feel so dumb myself UwU.)</p><h2 id="The-Kid-Protocol-an-UDP-based-application-Protocol"><a href="#The-Kid-Protocol-an-UDP-based-application-Protocol" class="headerlink" title="The Kid Protocol - an UDP based application Protocol"></a>The Kid Protocol - an UDP based application Protocol</h2><h3 id="From-the-challenge-description"><a href="#From-the-challenge-description" class="headerlink" title="From the challenge description:"></a>From the challenge description:</h3><blockquote><p><strong>Kid Protocol</strong> is an application-layer protocol that has just been created based on the UDP protocol.<br>The Python code below is the source code of the server running the <strong>Kid Protocol</strong>. If you have. Can you read this protocol and write a program to communicate with the server?</p></blockquote><p>Access information:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Server IP: 178.128.19.56 (Probably outdated, not working anymore)</span><br><span class="line">UDP Port: 3108</span><br></pre></td></tr></table></figure><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>Here’s an overview of the kid protocol server code provided by the challenge</p><figure class="highlight python"><figcaption><span>kid_server.py</span><a href="/downloads/code/kid_server.py">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cấu hình tập tin lưu log của server</span></span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;./log/kid_server.log&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KidServer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, port</span>):</span><br><span class="line">        <span class="comment"># Khởi tạo UDP socket và lắng nghe kết nối</span></span><br><span class="line">        self.socket = socket.socket(family=socket.AF_INET, <span class="built_in">type</span>=socket.SOCK_DGRAM)</span><br><span class="line">        self.socket.bind((host, port))</span><br><span class="line">        self.fileList = [<span class="string">&quot;intro.txt&quot;</span>, <span class="string">&quot;flag.txt&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Vòng lặp vô hạn xử lý các gói tin nhận được</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                rawPacket, clientIP = self.socket.recvfrom(<span class="number">4096</span>)</span><br><span class="line">                data = self.handle(rawPacket)</span><br><span class="line">                self.response(data, clientIP)</span><br><span class="line">            <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                logging.exception(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Xử lý gói tin nhận được</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, rawPacket</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            kidPacket = KidPacket(rawPacket)</span><br><span class="line">            action = getValue(kidPacket.body, <span class="string">&quot;action&quot;</span>)</span><br><span class="line">            inputFile = getValue(kidPacket.body, <span class="string">&quot;file&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> action == <span class="string">&quot;read&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> inputFile <span class="keyword">in</span> self.fileList:</span><br><span class="line">                    file = inputFile</span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    file = <span class="string">&quot;intro.txt&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Wrong action&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Gửi phản hồi về cho client</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">response</span>(<span class="params">self, data, clientIP</span>):</span><br><span class="line">        self.socket.sendto(<span class="built_in">bytes</span>(data, encoding=<span class="string">&quot;utf8&quot;</span>), clientIP)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getValue</span>(<span class="params"><span class="built_in">object</span>, key</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">object</span>[key]</span><br><span class="line">    <span class="keyword">except</span> KeyError:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Missing &#x27;%s&#x27; param&quot;</span> % key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KidPacket</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, rawPacket</span>):</span><br><span class="line">        self.parse(rawPacket)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Hàm xử lý / kiểm tra cấu trúc gói tin</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, rawPacket</span>):</span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#   Dòng code bên dưới đang chuyển đổi 2 bytes đầu của gói tin</span></span><br><span class="line">        <span class="comment"># từ dạng little endian về dạng số, đây là phần contentLength.</span></span><br><span class="line">        <span class="comment"># Em có thể tìm hiểu thêm hàm struct.pack(), nó sẽ giúp em </span></span><br><span class="line">        <span class="comment"># chuyển đổi theo chiều ngược lại.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        self.contentLength = struct.unpack(<span class="string">&quot;&lt;H&quot;</span>, rawPacket[<span class="number">0</span>:<span class="number">2</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Các bytes còn lại của gói tin được xem là phần dữ liệu</span></span><br><span class="line">        data = rawPacket[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.contentLength != <span class="built_in">len</span>(data):</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;Bad content-length&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Chuyển đổi dữ liệu nhận được thành JSON object</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.body = json.loads(data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;Bad format&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># Khởi tạo server lắng nghe trên 0.0.0.0:3108</span></span><br><span class="line">    server = KidServer(<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">3108</span>)</span><br><span class="line">    server.start()</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Foreword&quot;&gt;&lt;a href=&quot;#Foreword&quot; class=&quot;headerlink&quot; title=&quot;Foreword&quot;&gt;&lt;/a&gt;Foreword&lt;/h2&gt;&lt;p&gt;This is my first ever CTF writeup I ever done in my life, since I ever delved into the rabbit hole of CTF and cybersecurity. &lt;/p&gt;
&lt;p&gt;The challenge is from the CTFFlag Asia Junior&lt;/p&gt;
&lt;p&gt;I’ll put a link here if you want to learn more:&lt;br&gt;&lt;a href=&quot;https://junior.ctflag.asia/&quot;&gt;CTFFlag Asia Junior&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(I never feel so dumb myself UwU.)&lt;/p&gt;
&lt;h2 id=&quot;The-Kid-Protocol-an-UDP-based-application-Protocol&quot;&gt;&lt;a href=&quot;#The-Kid-Protocol-an-UDP-based-application-Protocol&quot; class=&quot;headerlink&quot; title=&quot;The Kid Protocol - an UDP based application Protocol&quot;&gt;&lt;/a&gt;The Kid Protocol - an UDP based application Protocol&lt;/h2&gt;&lt;h3 id=&quot;From-the-challenge-description&quot;&gt;&lt;a href=&quot;#From-the-challenge-description&quot; class=&quot;headerlink&quot; title=&quot;From the challenge description:&quot;&gt;&lt;/a&gt;From the challenge description:&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;Kid Protocol&lt;/strong&gt; is an application-layer protocol that has just been created based on the UDP protocol.&lt;br&gt;The Python code below is the source code of the server running the &lt;strong&gt;Kid Protocol&lt;/strong&gt;. If you have. Can you read this protocol and write a program to communicate with the server?&lt;/p&gt;
&lt;/blockquote&gt;


&lt;p&gt;Access information:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Server IP: 178.128.19.56 (Probably outdated, not working anymore)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;UDP Port: 3108&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Programming and Hacking" scheme="http://example.com/categories/Programming-and-Hacking/"/>
    
    <category term="CTF" scheme="http://example.com/categories/Programming-and-Hacking/CTF/"/>
    
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="python" scheme="http://example.com/tags/python/"/>
    
    <category term="networking" scheme="http://example.com/tags/networking/"/>
    
  </entry>
  
</feed>
